<UserControl
    x:Class="Eventa.Views.Events.BrowseAdminEventsView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
    xmlns:converters="clr-namespace:Eventa.Converters;assembly=Eventa"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:li="using:LoadingIndicators.Avalonia"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:Eventa.ViewModels.Events"
    d:DesignHeight="750"
    d:DesignWidth="800"
    x:CompileBindings="True"
    x:DataType="vm:BrowseAdminEventsViewModel"
    mc:Ignorable="d">
    
    <UserControl.Styles>
        <Style Selector="TextBlock.Title">
            <Setter Property="FontFamily" Value="{StaticResource Kadwa}" />
            <Setter Property="FontSize" Value="28" />
            <Setter Property="Foreground" Value="#FFB5B5" />
            <Setter Property="HorizontalAlignment" Value="Center" />
        </Style>

        <Style Selector="Border.EventCard">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#999999" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="30,5,30,0" />
        </Style>

        <Style Selector="TextBlock.EventTitle">
            <Setter Property="FontFamily" Value="{StaticResource Kadwa}" />
            <Setter Property="FontSize" Value="24" />
            <Setter Property="Foreground" Value="#FFB5B5" />
        </Style>

        <Style Selector="TextBlock.EventDetails">
            <Setter Property="FontFamily" Value="{StaticResource Kadwa}" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="#666666" />
        </Style>

        <Style Selector="Button.ActionButton">
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="16,6" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="FontFamily" Value="{StaticResource Kadwa}" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="White" />
        </Style>

        <Style Selector="Button.ViewButton">
            <Setter Property="Background" Value="#FFB5B5" />
        </Style>

        <Style Selector="Button.ViewButton:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#FF9999" />
        </Style>
    </UserControl.Styles>

    <UserControl.Resources>
        <converters:StringNotEmptyConverter x:Key="StringNotEmpty" />
        <converters:RatingToStarConverter x:Key="RatingToStarConverter" />
    </UserControl.Resources>

    <Grid RowDefinitions="Auto,*">
        <!--  Header  -->
        <Border
            Grid.Row="0"
            Margin="0,0,0,24"
            BoxShadow="5 5 10 0 DarkGray">
            <TextBlock Classes="Title" Text="New Requests" />
        </Border>

        <!--  Loading Indicator  -->
        <StackPanel
            Grid.Row="1"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            IsVisible="{Binding IsLoading}"
            Spacing="5">
            <li:LoadingIndicator
                Width="200"
                Height="200"
                Foreground="#FF8181"
                IsActive="{Binding IsLoading}"
                Mode="Arcs"
                SpeedRatio="1.2" />
            <ScrollViewer
                MaxWidth="200"
                MaxHeight="100"
                IsScrollChainingEnabled="False">
                <TextBlock
                    FontFamily="{StaticResource Kadwa}"
                    Foreground="#FF8181"
                    IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmpty}}"
                    Text="{Binding ErrorMessage}"
                    TextAlignment="Center"
                    TextWrapping="WrapWithOverflow" />
            </ScrollViewer>
        </StackPanel>

        <!--  Events List  -->
        <ScrollViewer
            Grid.Row="1"
            IsVisible="{Binding !IsLoading}"
            ScrollViewer.IsScrollChainingEnabled="False">
            <ItemsControl ItemsSource="{Binding PendingEvents}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Classes="EventCard">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <!--  Event Image  -->
                                <Border
                                    Grid.Column="0"
                                    Width="115"
                                    Height="97"
                                    Background="#D9D9D9"
                                    ClipToBounds="True"
                                    CornerRadius="8">
                                    <asyncImageLoader:AdvancedImage Source="{Binding ImageUrl}" Stretch="UniformToFill" />
                                </Border>
                                <!--  Event Details  -->
                                <StackPanel
                                    Grid.Column="1"
                                    Margin="16,0,0,0"
                                    VerticalAlignment="Center"
                                    Spacing="4">
                                    <TextBlock Classes="EventTitle" Text="{Binding Title}" />
                                    <TextBlock Classes="EventDetails">
                                        <Run Text="Organiser name: " />
                                        <Run FontWeight="SemiBold" Text="{Binding OrganizerName}" />
                                    </TextBlock>
                                    <TextBlock
                                        Classes="EventDetails"
                                        IsVisible="{Binding OrganizationName, Converter={StaticResource StringNotEmpty}}">
                                        <Run Text="Organisation name: " />
                                        <Run FontWeight="SemiBold" Text="{Binding OrganizationName}" />
                                    </TextBlock>
                            
                                    <!--  Rating Display  -->
                                    <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                        <TextBlock
                                            Text="{Binding AverageRating, StringFormat='{}{0:0.0}'}"
                                            FontSize="12"
                                            FontWeight="SemiBold"
                                            Foreground="#FFFFB5C5"
                                            VerticalAlignment="Center"/>
                                
                                        <StackPanel Orientation="Horizontal" Spacing="2">
                                            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                                                      Width="14" Height="14"
                                                      Foreground="{Binding RoundedAverageRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=1}"/>
                                            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                                                      Width="14" Height="14"
                                                      Foreground="{Binding RoundedAverageRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=2}"/>
                                            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                                                      Width="14" Height="14"
                                                      Foreground="{Binding RoundedAverageRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=3}"/>
                                            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                                                      Width="14" Height="14"
                                                      Foreground="{Binding RoundedAverageRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=4}"/>
                                            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                                                      Width="14" Height="14"
                                                      Foreground="{Binding RoundedAverageRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=5}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                                <!--  View Details Button  -->
                                <Button
                                    Grid.Column="2"
                                    VerticalAlignment="Center"
                                    Classes="ActionButton ViewButton"
                                    Command="{Binding $parent[UserControl].((vm:BrowseAdminEventsViewModel)DataContext).ViewEventDetailsCommand}"
                                    CommandParameter="{Binding}">
                                    <TextBlock Text="View details" />
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>