<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="using:Eventa.ViewModels.Main"
             mc:Ignorable="d" d:DesignWidth="280" d:DesignHeight="600"
             x:DataType="viewModels:ProfileViewModel"
             xmlns:converters="using:Eventa.Converters"
             xmlns:models="using:Eventa.Models.Authentication"
             x:Class="Eventa.Views.Main.ProfileView">
    <UserControl.Resources>
        <converters:RatingToStarConverter x:Key="RatingToStarConverter"/>
        <converters:BoolToButtonColorConverter x:Key="BoolToButtonColorConverter"/>
        <converters:StringNotEmptyConverter x:Key="StringNotEmptyConverter"/>
    </UserControl.Resources>
  <ScrollViewer>
    <StackPanel Spacing="15" Margin="20">
      
      <!-- Profile Header -->
      <StackPanel HorizontalAlignment="Center" Spacing="8">
        <!-- Profile Picture -->
        <Border Width="100" Height="100" 
                CornerRadius="50"
                Background="#FFFFB5C5"
                HorizontalAlignment="Center">
          <PathIcon Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"
                    Width="50" Height="50"
                    Foreground="White"/>
        </Border>

        <!-- Username -->
        <TextBlock Text="{Binding UserName}"
                   FontSize="20"
                   FontWeight="Bold"
                   Foreground="#FFFFB5C5"
                   HorizontalAlignment="Center"/>

        <!-- Email -->
        <TextBlock Text="{Binding Email}"
                   FontSize="13"
                   Foreground="#FF999999"
                   HorizontalAlignment="Center"/>

        <!-- Organization (Organizer only) -->
        <TextBlock Text="{Binding Organization}"
                   FontSize="13"
                   Foreground="#FF999999"
                   HorizontalAlignment="Center"
                   IsVisible="{Binding IsOrganizer}"/>

        <!-- Rating (Organizer only) -->
        <StackPanel IsVisible="{Binding IsOrganizer}" 
                    HorizontalAlignment="Center"
                    Spacing="8"
                    Margin="0,5,0,0">
          <TextBlock Text="{Binding Rating, StringFormat='{}{0:0.0} / 5'}"
                     FontSize="18"
                     FontWeight="SemiBold"
                     Foreground="#FFFFB5C5"
                     HorizontalAlignment="Center"/>
          
          <!-- Star Rating Display -->
          <StackPanel Orientation="Horizontal" 
                      HorizontalAlignment="Center"
                      Spacing="3">
            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                      Width="24" Height="24"
                      Foreground="{Binding RoundedRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=1}"/>
            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                      Width="24" Height="24"
                      Foreground="{Binding RoundedRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=2}"/>
            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                      Width="24" Height="24"
                      Foreground="{Binding RoundedRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=3}"/>
            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                      Width="24" Height="24"
                      Foreground="{Binding RoundedRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=4}"/>
            <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                      Width="24" Height="24"
                      Foreground="{Binding RoundedRating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=5}"/>
          </StackPanel>
        </StackPanel>
      </StackPanel>

      <!-- Action Buttons -->
      <StackPanel Spacing="10" HorizontalAlignment="Center" Margin="0,10,0,0">
        <!-- My Tickets Button (User) -->
        <Button Content="My tickets"
                Command="{Binding NavigateToMyTicketsCommand}"
                Background="#FFFFB5C5"
                Foreground="White"
                FontWeight="SemiBold"
                FontSize="14"
                Padding="40,12"
                CornerRadius="8"
                IsVisible="{Binding !IsOrganizer}"
                HorizontalAlignment="Center"
                BorderThickness="0"/>

        <!-- Comment Tabs (Organizer) -->
        <StackPanel Orientation="Horizontal" 
                    Spacing="8"
                    HorizontalAlignment="Center"
                    IsVisible="{Binding IsOrganizer}">
          <Button Content="Event comments"
                  Command="{Binding ShowEventCommentsTabCommand}"
                  Background="{Binding ShowEventComments, Converter={StaticResource BoolToButtonColorConverter}}"
                  Foreground="White"
                  FontWeight="SemiBold"
                  FontSize="13"
                  Padding="18,10"
                  CornerRadius="8"
                  BorderThickness="0"/>
          <Button Content="My comments"
                  Command="{Binding ShowMyCommentsTabCommand}"
                  Background="{Binding ShowMyComments, Converter={StaticResource BoolToButtonColorConverter}}"
                  Foreground="White"
                  FontWeight="SemiBold"
                  FontSize="13"
                  Padding="18,10"
                  CornerRadius="8"
                  BorderThickness="0"/>
        </StackPanel>
      </StackPanel>

      <!-- Comments List (User - My Comments) -->
      <ItemsControl ItemsSource="{Binding MyComments}"
                    IsVisible="{Binding !IsOrganizer}"
                    Margin="0,10,0,0">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border BorderBrush="#FFD0D0D0"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="12"
                    Margin="0,0,0,10"
                    Background="White">
              <StackPanel Spacing="8">
                <!-- Event Name -->
                <TextBlock Text="[Event name]"
                           FontWeight="SemiBold"
                           FontSize="13"
                           Foreground="#FF666666"/>
                
                <!-- Comment with Stars -->
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Grid.Column="0"
                             Text="{Binding Content}"
                             TextWrapping="Wrap"
                             FontSize="12"
                             Foreground="#FF999999"
                             VerticalAlignment="Top"
                             LineHeight="18"/>
                  <StackPanel Grid.Column="1" 
                              Orientation="Horizontal" 
                              Spacing="2"
                              VerticalAlignment="Top"
                              Margin="10,0,0,0">
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=1}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=2}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=3}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=4}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=5}"/>
                  </StackPanel>
                </Grid>
              </StackPanel>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <!-- Comments List (Organizer - Event Comments Tab) -->
      <ItemsControl ItemsSource="{Binding EventComments}"
                    IsVisible="{Binding ShowEventComments}"
                    Margin="0,10,0,0">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border BorderBrush="#FFD0D0D0"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="12"
                    Margin="0,0,0,10"
                    Background="White">
              <StackPanel Spacing="8">
                <!-- User Info with Avatar and Stars -->
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <Border Grid.Column="0"
                          Width="32" Height="32"
                          CornerRadius="16"
                          Background="#FFFFB5C5"
                          VerticalAlignment="Top"
                          Margin="0,0,8,0">
                    <TextBlock Text="{Binding UserInitial}"
                               FontSize="14"
                               FontWeight="Bold"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                  </Border>
                  
                  <TextBlock Grid.Column="1"
                             Text="{Binding UserName}"
                             FontWeight="SemiBold"
                             FontSize="13"
                             Foreground="#FF333333"
                             VerticalAlignment="Center"/>
                  
                  <StackPanel Grid.Column="2" 
                              Orientation="Horizontal" 
                              Spacing="2"
                              VerticalAlignment="Center">
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=1}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=2}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=3}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=4}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=5}"/>
                  </StackPanel>
                </Grid>
                
                <!-- Comment Text -->
                <TextBlock Text="{Binding Content}"
                           TextWrapping="Wrap"
                           FontSize="12"
                           Foreground="#FF999999"
                           LineHeight="18"/>
              </StackPanel>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <!-- Comments List (Organizer - My Comments Tab) -->
      <ItemsControl ItemsSource="{Binding MyComments}"
                    IsVisible="{Binding ShowMyComments}"
                    Margin="0,10,0,0">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border BorderBrush="#FFD0D0D0"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="12"
                    Margin="0,0,0,10"
                    Background="White">
              <StackPanel Spacing="8">
                <!-- User Info with Avatar and Stars -->
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <Border Grid.Column="0"
                          Width="32" Height="32"
                          CornerRadius="16"
                          Background="#FFFFB5C5"
                          VerticalAlignment="Top"
                          Margin="0,0,8,0">
                    <TextBlock Text="{Binding UserInitial}"
                               FontSize="14"
                               FontWeight="Bold"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                  </Border>
                  
                  <TextBlock Grid.Column="1"
                             Text="{Binding UserName}"
                             FontWeight="SemiBold"
                             FontSize="13"
                             Foreground="#FF333333"
                             VerticalAlignment="Center"/>
                  
                  <StackPanel Grid.Column="2" 
                              Orientation="Horizontal" 
                              Spacing="2"
                              VerticalAlignment="Center">
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=1}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=2}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=3}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=4}"/>
                    <PathIcon Data="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"
                              Width="16" Height="16"
                              Foreground="{Binding Rating, Converter={StaticResource RatingToStarConverter}, ConverterParameter=5}"/>
                  </StackPanel>
                </Grid>
                
                <!-- Comment Text -->
                <TextBlock Text="{Binding Content}"
                           TextWrapping="Wrap"
                           FontSize="12"
                           Foreground="#FF999999"
                           LineHeight="18"/>
              </StackPanel>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <!-- Loading Indicator -->
      <TextBlock Text="Loading..."
                 IsVisible="{Binding IsLoading}"
                 HorizontalAlignment="Center"
                 Foreground="#FF999999"
                 FontSize="13"/>

      <!-- Error Message -->
      <TextBlock Text="{Binding ErrorMessage}"
                 IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                 Foreground="#FFFF6B6B"
                 TextWrapping="Wrap"
                 HorizontalAlignment="Center"
                 FontSize="13"/>

    </StackPanel>
  </ScrollViewer>
</UserControl>